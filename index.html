<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Приглашение на нашу свадьбу</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Дорогие гости!</h1>
            <p class="subtitle">Мы рады пригласить вас на празднование нашего свадьбы!</p>
            <div class="couple-names">
                <span>Анна</span>
                <i class="fas fa-heart"></i>
                <span>Иван</span>
            </div>
            <p class="date">15 июля 2024 года</p>
        </header>

        <section class="form-section">
            <h2>Подтвердите, пожалуйста, своё присутствие и выбор напитков до 1 июля</h2>
            
            <!-- Основной гость -->
            <div class="guest-section">
                <h3>Основной гость</h3>
                <div class="form-group">
                    <label for="name">Ваше имя и фамилия *</label>
                    <input type="text" id="name" name="name" required>
                </div>

                <div class="form-group">
                    <label>Выберите напитки (можно несколько):</label>
                    <div class="checkbox-group" id="mainAlcoholGroup">
                        <label class="checkbox-label">
                            <input type="checkbox" value="Красное вино">
                            <span class="checkmark"></span>
                            Красное вино
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="Белое вино">
                            <span class="checkmark"></span>
                            Белое вино
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="Шампанское">
                            <span class="checkmark"></span>
                            Шампанское
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="Виски">
                            <span class="checkmark"></span>
                            Виски
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="Водка">
                            <span class="checkmark"></span>
                            Водка
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="Коньяк">
                            <span class="checkmark"></span>
                            Коньяк
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="Не пью алкоголь">
                            <span class="checkmark"></span>
                            Не пью алкоголь
                        </label>
                    </div>
                </div>
            </div>

            <!-- Дополнительные гости -->
            <div id="additionalGuests">
                <!-- Дополнительные гости будут добавляться здесь -->
            </div>

            <!-- Кнопка добавления гостя -->
            <div class="form-group">
                <button type="button" id="addGuestBtn" class="add-guest-btn">
                    <i class="fas fa-plus"></i> Добавить ещё гостя
                </button>
            </div>

            <button type="button" id="submitBtn" class="submit-btn">Отправить все ответы</button>
            
            <div id="formMessage" style="display: none; margin-top: 20px; padding: 10px; border-radius: 5px; text-align: center;"></div>
        </section>
    </div>

    <script>
        let guestCount = 0;

        // Функция добавления дополнительного гостя
        document.getElementById('addGuestBtn').addEventListener('click', function() {
            guestCount++;
            const newGuest = document.createElement('div');
            newGuest.className = 'guest-section';
            newGuest.innerHTML = `
                <h3>Дополнительный гость ${guestCount}</h3>
                <button type="button" class="remove-guest-btn" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i> Удалить
                </button>
                <div class="form-group">
                    <label>Имя и фамилия</label>
                    <input type="text" id="guest${guestCount}_name" placeholder="Введите имя и фамилию">
                </div>
                <div class="form-group">
                    <label>Выберите напитки:</label>
                    <div class="checkbox-group" id="guest${guestCount}_alcohol">
                        <label class="checkbox-label">
                            <input type="checkbox" value="Красное вино">
                            <span class="checkmark"></span>
                            Красное вино
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="Белое вино">
                            <span class="checkmark"></span>
                            Белое вино
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="Шампанское">
                            <span class="checkmark"></span>
                            Шампанское
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="Виски">
                            <span class="checkmark"></span>
                            Виски
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="Водка">
                            <span class="checkmark"></span>
                            Водка
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="Коньяк">
                            <span class="checkmark"></span>
                            Коньяк
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="Не пью алкоголь">
                            <span class="checkmark"></span>
                            Не пью алкоголь
                        </label>
                    </div>
                </div>
            `;
            document.getElementById('additionalGuests').appendChild(newGuest);
        });

        // Функция получения выбранных напитков
        function getSelectedAlcohol(containerId) {
            const checkboxes = document.querySelectorAll(`#${containerId} input[type="checkbox"]:checked`);
            return Array.from(checkboxes).map(cb => cb.value);
        }

        // Обработка отправки
        document.getElementById('submitBtn').addEventListener('click', function() {
            const submitButton = this;
            const messageDiv = document.getElementById('formMessage');
            const name = document.getElementById('name').value;

            if (!name) {
                alert('Пожалуйста, введите ваше имя и фамилию');
                return;
            }

            submitButton.textContent = 'Отправляется...';
            submitButton.disabled = true;

            // Собираем данные основного гостя
            const mainAlcohol = getSelectedAlcohol('mainAlcoholGroup');
            
            // Собираем данные дополнительных гостей
            const additionalGuests = [];
            for (let i = 1; i <= guestCount; i++) {
                const guestName = document.getElementById(`guest${i}_name`);
                if (guestName && guestName.value.trim() !== '') {
                    const guestAlcohol = getSelectedAlcohol(`guest${i}_alcohol`);
                    additionalGuests.push({
                        name: guestName.value,
                        alcohol: guestAlcohol
                    });
                }
            }

            // Создаем URL с параметрами
            let url = 'https://script.google.com/macros/s/AKfycbxgURBR4l1OfAyto1X6KyAVi73NvRIxg8PqsIE86lwdmqwMCcMoYX9mfAdnmFimhcRDiQ/exec?';
            url += 'name=' + encodeURIComponent(name);
            url += '&alcohol=' + encodeURIComponent(mainAlcohol.join(','));
            
            // Добавляем дополнительных гостей
            additionalGuests.forEach((guest, index) => {
                url += `&guest${index + 1}_name=` + encodeURIComponent(guest.name);
                url += `&guest${index + 1}_alcohol=` + encodeURIComponent(guest.alcohol.join(','));
            });

            console.log('Отправляемый URL:', url);

            // Отправляем GET запрос
            fetch(url)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    messageDiv.style.display = 'block';
                    messageDiv.style.backgroundColor = '#d4edda';
                    messageDiv.style.color = '#155724';
                    messageDiv.textContent = 'Спасибо! Все ответы успешно отправлены. Ждём вас на празднике!';
                    
                    // Сбрасываем форму
                    document.getElementById('name').value = '';
                    
                    // Снимаем выделение с чекбоксов
                    const allCheckboxes = document.querySelectorAll('input[type="checkbox"]');
                    allCheckboxes.forEach(checkbox => {
                        checkbox.checked = false;
                    });
                    
                    // Очищаем дополнительных гостей
                    document.getElementById('additionalGuests').innerHTML = '';
                    guestCount = 0;
                } else {
                    throw new Error(data.message || 'Ошибка сервера');
                }
            })
            .catch(error => {
                console.error('Ошибка:', error);
                messageDiv.style.display = 'block';
                messageDiv.style.backgroundColor = '#f8d7da';
                messageDiv.style.color = '#721c24';
                messageDiv.textContent = 'Произошла ошибка при отправке. Пожалуйста, попробуйте ещё раз.';
            })
            .finally(() => {
                submitButton.textContent = 'Отправить все ответы';
                submitButton.disabled = false;
            });
        });
    </script>
</body>
</html>